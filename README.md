# **弹幕系统**

## **简介**
这是一个基于 Flask 和 Socket.IO 的实时弹幕系统，支持教师端和学生端的互动功能。  
- **教师端**：可以发送弹幕、控制弹幕显示，并生成二维码供学生扫码加入直播间。  
- **学生端**：可以发送弹幕、设置弹幕颜色和速度，并实时查看其他用户发送的弹幕。
- **服务端**：部署于服务器上，用于提供服务
---

## **功能说明**

### **教师端**
- **发送弹幕**：教师可以输入弹幕内容并发送。
- **覆盖弹幕窗口**：支持全屏覆盖弹幕显示。
- **弹幕颜色选择**：教师可以选择弹幕颜色。
- **二维码生成**：生成包含直播间地址的二维码，供学生扫码加入。
- **实时弹幕显示**：实时显示学生发送的弹幕。

### **学生端**
- **发送弹幕**：学生可以输入弹幕内容并发送。
- **弹幕颜色选择**：学生可以选择弹幕颜色。
- **弹幕速度调节**：学生可以通过滑块调节弹幕速度。
- **实时弹幕显示**：实时显示教师和其他学生发送的弹幕。
- **用户名设置**：学生可以设置自己的用户名。

---

## **技术栈**
- **后端**：
  - Flask
  - Flask-SocketIO
- **前端**：
  - HTML5 + CSS3
  - JavaScript (Socket.IO)
- **教师端**：
  - PyQt6
  - qrcode (二维码生成)
- **数据库**：
  - 内存存储（`collections.defaultdict` 和 `deque`）

---

## **服务端安装步骤**

只需要按照服务端以及编译一次教师端，学生端无需处理。
### **1. 克隆项目**
```bash
git clone https://github.com/your-repo/danmuku.git
cd danmuku
```

### **2. 安装依赖**

#### **后端依赖**
```bash
pip install flask flask-socketio eventlet
```

#### **教师端依赖**（如果编译为单文件可选）
```bash
pip install PyQt6 qrcode
```

---

## **运行步骤**

### **1. 启动后端服务器**
在项目根目录下运行以下命令：
```bash
python app.py
```
默认服务器地址为 `http://127.0.0.1:7676`。

### **2. 启动教师端**
进入 `teacher` 目录，运行以下命令：
```bash
python teacher_client.py
```
教师端启动后，输入直播间号和用户名即可进入。  
如果不想安装环境，也可以使用构建好的 `teacher_client.exe`（位于 `/src/teacher_client.exe`，推荐自行编译一次）。

### **3. 访问学生端**
在浏览器中访问：
```plaintext
http://127.0.0.1:7676/
```
输入直播间号后进入对应的直播间。

---

## **配置文件**

### **config.json**
项目根目录下的 `config.json` 文件用于配置服务器地址：
```json
{
    "server_url": "http://127.0.0.1:7676"
}
```

教师端的 `config.json` 文件位于 `teacher` 目录下，用于配置教师端的默认服务器地址：
```json
{
    "server_url": "http://127.0.0.1:7676"
}
```

---

## **使用方法**

### **教师端**
1. 启动教师端应用。
2. 输入直播间号和用户名，点击 **进入直播间**。
3. 在主界面中：
   - 输入弹幕内容并点击 **发送** 按钮发送弹幕。
   - 点击 **选择颜色** 按钮选择弹幕颜色。
   - 点击 **启动弹幕覆盖** 按钮显示全屏弹幕窗口。

### **学生端**
1. 在浏览器中访问学生端页面。
2. 输入直播间号并加入直播间。
3. 在页面中：
   - 输入弹幕内容并点击 **发送弹幕** 按钮发送弹幕。
   - 点击颜色按钮选择弹幕颜色。
   - 调节滑块调整弹幕速度。

---

## **项目结构**

```
danmuku/
├── app.py                     # 后端主程序
├── config.json                # 后端配置文件
├── templates/                 # 前端模板文件
│   ├── index.html             # 学生端主页
│   └── danmuku.html           # 学生端直播间页面
├── teacher/                   # 教师端代码
│   ├── teacher_client.py      # 教师端主程序
│   ├── socket_client.py       # 教师端 Socket.IO 客户端
│   ├── danmu_renderer.py      # 教师端弹幕渲染
│   └── config.json            # 教师端配置文件
├── static/                    # 静态资源（可选）
├── dockerfile                 # Docker 构建文件
├── docker-compose.yml         # Docker 启动文件
```

---

## **注意事项**
1. **服务器地址**：
   - 默认服务器地址为 `127.0.0.1:7676`，可在 `config.json` 文件中修改。
2. **依赖安装**：
   - 请确保安装了所有依赖库，特别是 `flask-socketio` 和 `PyQt6`。
3. **浏览器兼容性**：
   - 学生端页面建议使用现代浏览器（如 Chrome 或 Edge）。

---

## **示例截图**

### **教师端**
![教师端截图](/img/PixPin_2025-03-29_23-57-46.png)
![教师端截图](/img/PixPin_2025-03-30_00-01-35.png)

### **学生端**
![学生端截图](/img/PixPin_2025-03-29_23-58-23.png)
![学生端截图](/img/PixPin_2025-03-29_23-59-11.png)
---

本项目纯纯应付大学作业，写好架构，具体代码全是ai生成的，然后人工测试debug。

---

## **许可证**
本项目基于 MIT 许可证开源，详情请查看 [LICENSE](./LICENSE) 文件。由于教师端使用了pyqt6，建议重写以防止许可证污染。

---